<template>
  <div class="bg-white dark:bg-slate-800 md:rounded-lg ring-1 ring-slate-900/5 mb-4">
    <div class="px-6 py-4">
      <!-- User -->
      <div class="flex items-center">
        <!-- Avatar -->
        <img
          :src="user.image_url"
          class="rounded-full h-min mr-4"
          alt="Avatar"
          width="48px"
          height="48px"
        >

        <div class="w-full">
          <!-- User name -->
          <div class="flex flex-row text-slate-900 dark:text-white items-center">
            <a
              href="#"
              class="font-bold hover:underline"
            >{{ user.name }}</a>

            <span
              v-if="user.is_verified"
              class="flex items-center cursor-pointer text-primary-500 hover:text-primary-600 dark:hover:text-primary-400 ml-1"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 22 22"
                fill="currentColor"
              >
                <path
                  d="M21.6274 10.8154L19.3258 8.19629L19.6466 4.73229L16.2414 3.96251L14.4587 0.958496L11.2517 2.32908L8.04464 0.958496L6.26191 3.95312L2.85679 4.71351L3.17749 8.1869L0.875977 10.8154L3.17749 13.4345L2.85679 16.9079L6.26191 17.6777L8.04464 20.6723L11.2517 19.2924L14.4587 20.6629L16.2414 17.6683L19.6466 16.8985L19.3258 13.4345L21.6274 10.8154ZM10.1564 14.5414C9.76608 14.931 9.13406 14.931 8.74369 14.5415L6.56495 12.3674C6.17918 11.9824 6.17959 11.3573 6.56587 10.9729C6.95049 10.5901 7.57234 10.5908 7.95613 10.9744L9.45008 12.4676L14.2735 7.65074C14.6574 7.26733 15.2792 7.2668 15.6638 7.64956C16.0502 8.03408 16.0506 8.65932 15.6647 9.04437L10.1564 14.5414Z"
                />
              </svg>
              <span class="ml-1 font-bold text-sm">Verified</span>
            </span>
          </div>
          <!-- time -->
          <div class="text-slate-500 dark:text-slate-400 text-sm mt-1">
            {{ $moment(createdAt).fromNow() }}
          </div>
        </div>
      </div>

      <!-- Content -->
      <div
        class="text-slate-900 dark:text-white mt-4 break-word text-sm"
        v-html="content"
      />
    </div>

    <!-- Post image -->
    <div
      v-if="imageUrl"
      class="bg-slate-100 dark:bg-slate-900/50 cursor-pointer"
    >
      <img
        :src="imageUrl"
        alt="Post image"
        class="w-100 max-h-[480px] mx-auto"
      >
    </div>

    <!-- Actions -->
    <div class="grid grid-cols-3 gap-2 border-b border-slate-200 dark:border-slate-700 mx-4 mb-2 py-2">
      <PostActionButton>
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M20.16 5C19.1 3.93721 17.6948 3.28854 16.1984 3.17117C14.7019 3.0538 13.2128 3.47546 12 4.36C10.7277 3.41364 9.14402 2.98451 7.56795 3.15903C5.99188 3.33356 4.54047 4.09878 3.506 5.30058C2.47154 6.50239 1.93085 8.05152 1.99283 9.63601C2.05481 11.2205 2.71485 12.7227 3.84003 13.84L10.05 20.06C10.57 20.5718 11.2704 20.8586 12 20.8586C12.7296 20.8586 13.43 20.5718 13.95 20.06L20.16 13.84C21.3276 12.6653 21.983 11.0763 21.983 9.42C21.983 7.76372 21.3276 6.17473 20.16 5ZM18.75 12.46L12.54 18.67C12.4694 18.7414 12.3853 18.798 12.2926 18.8366C12.1999 18.8753 12.1005 18.8952 12 18.8952C11.8996 18.8952 11.8002 18.8753 11.7075 18.8366C11.6148 18.798 11.5307 18.7414 11.46 18.67L5.25003 12.43C4.46579 11.6283 4.02664 10.5515 4.02664 9.43C4.02664 8.30853 4.46579 7.23165 5.25003 6.43C6.04919 5.64099 7.127 5.19857 8.25003 5.19857C9.37306 5.19857 10.4509 5.64099 11.25 6.43C11.343 6.52373 11.4536 6.59812 11.5755 6.64889C11.6973 6.69966 11.828 6.7258 11.96 6.7258C12.092 6.7258 12.2227 6.69966 12.3446 6.64889C12.4665 6.59812 12.5771 6.52373 12.67 6.43C13.4692 5.64099 14.547 5.19857 15.67 5.19857C16.7931 5.19857 17.8709 5.64099 18.67 6.43C19.4651 7.22115 19.9186 8.29219 19.9336 9.41368C19.9485 10.5352 19.5237 11.6179 18.75 12.43V12.46Z"
          />
        </svg>

        <span class="ml-1">89</span>
      </PostActionButton>
      <PostActionButton>
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M7.99999 11C7.80221 11 7.60887 11.0586 7.44442 11.1685C7.27997 11.2784 7.1518 11.4346 7.07611 11.6173C7.00042 11.8 6.98062 12.0011 7.0192 12.1951C7.05779 12.3891 7.15303 12.5673 7.29288 12.7071C7.43273 12.847 7.61092 12.9422 7.8049 12.9808C7.99888 13.0194 8.19995 12.9996 8.38267 12.9239C8.5654 12.8482 8.72158 12.72 8.83146 12.5556C8.94134 12.3911 8.99999 12.1978 8.99999 12C8.99999 11.7348 8.89463 11.4804 8.70709 11.2929C8.51956 11.1054 8.2652 11 7.99999 11ZM12 11C11.8022 11 11.6089 11.0586 11.4444 11.1685C11.28 11.2784 11.1518 11.4346 11.0761 11.6173C11.0004 11.8 10.9806 12.0011 11.0192 12.1951C11.0578 12.3891 11.153 12.5673 11.2929 12.7071C11.4327 12.847 11.6109 12.9422 11.8049 12.9808C11.9989 13.0194 12.1999 12.9996 12.3827 12.9239C12.5654 12.8482 12.7216 12.72 12.8315 12.5556C12.9413 12.3911 13 12.1978 13 12C13 11.7348 12.8946 11.4804 12.7071 11.2929C12.5196 11.1054 12.2652 11 12 11ZM16 11C15.8022 11 15.6089 11.0586 15.4444 11.1685C15.28 11.2784 15.1518 11.4346 15.0761 11.6173C15.0004 11.8 14.9806 12.0011 15.0192 12.1951C15.0578 12.3891 15.153 12.5673 15.2929 12.7071C15.4327 12.847 15.6109 12.9422 15.8049 12.9808C15.9989 13.0194 16.1999 12.9996 16.3827 12.9239C16.5654 12.8482 16.7216 12.72 16.8315 12.5556C16.9413 12.3911 17 12.1978 17 12C17 11.7348 16.8946 11.4804 16.7071 11.2929C16.5196 11.1054 16.2652 11 16 11ZM12 2C10.6868 2 9.38641 2.25866 8.17315 2.7612C6.9599 3.26375 5.85751 4.00035 4.92892 4.92893C3.05356 6.8043 1.99999 9.34784 1.99999 12C1.99125 14.3091 2.79078 16.5485 4.25999 18.33L2.25999 20.33C2.12123 20.4706 2.02723 20.6492 1.98986 20.8432C1.95249 21.0372 1.97341 21.2379 2.04999 21.42C2.13305 21.5999 2.26769 21.7511 2.43683 21.8544C2.60598 21.9577 2.80199 22.0083 2.99999 22H12C14.6522 22 17.1957 20.9464 19.0711 19.0711C20.9464 17.1957 22 14.6522 22 12C22 9.34784 20.9464 6.8043 19.0711 4.92893C17.1957 3.05357 14.6522 2 12 2ZM12 20H5.40999L6.33999 19.07C6.43448 18.9774 6.50965 18.8669 6.56114 18.7451C6.61264 18.6232 6.63944 18.4923 6.63999 18.36C6.63623 18.0962 6.5284 17.8446 6.33999 17.66C5.03057 16.352 4.21516 14.6305 4.03268 12.7888C3.8502 10.947 4.31193 9.09901 5.33922 7.55952C6.3665 6.02004 7.89578 4.88436 9.6665 4.34597C11.4372 3.80759 13.3398 3.8998 15.0502 4.60691C16.7606 5.31402 18.1728 6.59227 19.0464 8.22389C19.92 9.85551 20.2009 11.7395 19.8411 13.555C19.4814 15.3705 18.5033 17.005 17.0735 18.1802C15.6438 19.3554 13.8508 19.9985 12 20Z"
          />
        </svg>

        <span class="ml-1">12</span>
      </PostActionButton>
      <PostActionButton>
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M18 14C17.4092 14.0039 16.8266 14.1386 16.294 14.3945C15.7615 14.6504 15.2922 15.0211 14.92 15.48L9.82003 13.13C10.0598 12.3957 10.0598 11.6042 9.82003 10.87L14.92 8.51999C15.5216 9.24596 16.3604 9.73607 17.2882 9.90383C18.216 10.0716 19.1732 9.90622 19.991 9.4369C20.8087 8.96757 21.4344 8.22447 21.7576 7.33874C22.0808 6.453 22.0807 5.48157 21.7573 4.5959C21.434 3.71022 20.8082 2.96724 19.9903 2.49806C19.1725 2.02889 18.2152 1.86369 17.2875 2.03162C16.3597 2.19955 15.521 2.68981 14.9196 3.41589C14.3181 4.14196 13.9924 5.05717 14 5.99999C14.003 6.23822 14.0265 6.47576 14.07 6.70999L8.79003 9.13999C8.22711 8.58957 7.51427 8.21751 6.74083 8.07042C5.96739 7.92333 5.16775 8.00776 4.44208 8.31312C3.71641 8.61849 3.09699 9.13121 2.66143 9.78705C2.22587 10.4429 1.99353 11.2127 1.99353 12C1.99353 12.7873 2.22587 13.5571 2.66143 14.2129C3.09699 14.8688 3.71641 15.3815 4.44208 15.6869C5.16775 15.9922 5.96739 16.0767 6.74083 15.9296C7.51427 15.7825 8.22711 15.4104 8.79003 14.86L14.07 17.29C14.0265 17.5242 14.003 17.7618 14 18C14 18.7911 14.2346 19.5645 14.6742 20.2223C15.1137 20.8801 15.7384 21.3928 16.4693 21.6955C17.2002 21.9983 18.0045 22.0775 18.7804 21.9231C19.5563 21.7688 20.269 21.3878 20.8285 20.8284C21.3879 20.269 21.7688 19.5563 21.9232 18.7804C22.0775 18.0044 21.9983 17.2002 21.6955 16.4693C21.3928 15.7384 20.8801 15.1136 20.2223 14.6741C19.5645 14.2346 18.7912 14 18 14ZM18 3.99999C18.3956 3.99999 18.7823 4.11729 19.1112 4.33705C19.4401 4.55682 19.6964 4.86917 19.8478 5.23463C19.9992 5.60008 20.0388 6.00221 19.9616 6.39017C19.8844 6.77813 19.6939 7.1345 19.4142 7.41421C19.1345 7.69391 18.7782 7.88439 18.3902 7.96156C18.0022 8.03873 17.6001 7.99913 17.2347 7.84775C16.8692 7.69638 16.5569 7.44003 16.3371 7.11113C16.1173 6.78223 16 6.39556 16 5.99999C16 5.46956 16.2107 4.96085 16.5858 4.58578C16.9609 4.21071 17.4696 3.99999 18 3.99999ZM6.00003 14C5.60447 14 5.21779 13.8827 4.88889 13.6629C4.55999 13.4432 4.30364 13.1308 4.15227 12.7654C4.00089 12.3999 3.96129 11.9978 4.03846 11.6098C4.11563 11.2218 4.30611 10.8655 4.58581 10.5858C4.86552 10.3061 5.22189 10.1156 5.60985 10.0384C5.99781 9.96125 6.39994 10.0009 6.7654 10.1522C7.13085 10.3036 7.4432 10.56 7.66297 10.8889C7.88273 11.2178 8.00003 11.6044 8.00003 12C8.00003 12.5304 7.78931 13.0391 7.41424 13.4142C7.03917 13.7893 6.53046 14 6.00003 14ZM18 20C17.6045 20 17.2178 19.8827 16.8889 19.6629C16.56 19.4432 16.3036 19.1308 16.1523 18.7654C16.0009 18.3999 15.9613 17.9978 16.0385 17.6098C16.1156 17.2218 16.3061 16.8655 16.5858 16.5858C16.8655 16.3061 17.2219 16.1156 17.6098 16.0384C17.9978 15.9613 18.3999 16.0009 18.7654 16.1522C19.1308 16.3036 19.4432 16.56 19.663 16.8889C19.8827 17.2177 20 17.6044 20 18C20 18.5304 19.7893 19.0391 19.4142 19.4142C19.0392 19.7893 18.5305 20 18 20Z"
          />
        </svg>

        <span class="ml-1">{{ $t('Share') }}</span>
      </PostActionButton>
    </div>

    <!-- Load previous comments -->
    <span
      class="px-4 hover:cursor-pointer text-slate-400 hover:text-slate-500 dark:hover:text-slate-300"
    >{{ $t('See previous comments') }}</span>

    <!-- Comments -->
    <div class="px-4 py-3">
      <PostComment
        v-for="item in comments"
        :key="`post-${postId}-comment-${item.id}`"
        :user="item.user"
        :created-at="item.created_at"
        :comment="item.comment"
        :image-url="item.image_url"
      />

      <!-- Write comment -->
      <form @submit.prevent="submit">
        <div class="flex flex-row">
          <!-- Avatar -->
          <img
            src="https://i.ibb.co/d7HBdMF/avatar-dendy.jpg"
            class="rounded-full h-min mr-3"
            alt="Avatar"
            width="36px"
            height="36px"
          >

          <!-- Textarea -->
          <div class="w-full">
            <!-- Post message -->
            <textarea
              id="content"
              v-model="comment"
              class="w-full bg-secondary-50 dark:bg-secondary-700 text-slate-900 dark:text-white rounded-lg px-3 py-2 outline-none resize-none"
              :placeholder="`${$t('Write a comment')}..`"
              rows="1"
              required
              @input="growTextarea"
            />
          </div>

          <!-- Send button -->
          <button
            type="submit"
            class="transition-width overflow-hidden text-primary-500 dark:text-primary-400 hover:text-primary-300 dark:hover:text-primary-300 flex items-center justify-center h-[40px]"
            :class="{'ml-1 w-[48px]': comment, 'w-0': !comment}"
          >
            <svg
              width="28"
              height="28"
              viewBox="0 0 24 24"
              fill="currentColor"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M21.7 10.7C21.4 10.1 20.9 9.69999 20.4 9.39999L6.40002 2.39999C4.90002 1.69999 3.10002 2.29999 2.40002 3.69999C1.90002 4.49999 1.90002 5.39999 2.30002 6.19999L4.40002 11H13.5C14.1 11 14.5 11.4 14.5 12C14.5 12.6 14.1 13 13.5 13H4.40002L2.30002 17.8C1.60002 19.3 2.30002 21.1 3.80002 21.8C4.20002 21.9 4.60002 22 5.00002 22C5.50002 22 5.90002 21.9 6.30002 21.7L20.3 14.7C21.8 13.9 22.4 12.1 21.7 10.7Z"
              />
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>
</template>

<script>
/* eslint-disable no-param-reassign */
export default {
  props: {
    postId: {
      type: Number,
      required: true,
    },
    user: {
      type: Object,
      required: true,
    },
    content: {
      type: String,
      required: true,
    },
    imageUrl: {
      type: String,
      default: '',
    },
    createdAt: {
      type: String,
      required: true,
    },
    comments: {
      type: Array,
      default: () => [],
    },
  },
  data() {
    return {
      comment: '',
    }
  },
  methods: {
    submit() {

    },
    growTextarea(event) {
      event.target.style.height = '5px'
      event.target.style.height = `${event.target.scrollHeight}px`
    },
  },
}
</script>

<style scoped>

</style>
